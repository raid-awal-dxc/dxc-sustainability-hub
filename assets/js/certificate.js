
async function renderCertificate(){ const user=await requireAuth(); const params=new URLSearchParams(window.location.search); const moduleId=params.get('module_id'); const code=params.get('code'); const score=params.get('score'); const {data:mod}=await supabaseClient.from('modules').select('title').eq('id',moduleId).single(); const moduleTitle=mod?.title||'Completed Module'; document.getElementById("cert-name").textContent=user.user_metadata?.full_name||user.email; document.getElementById("cert-module").textContent=moduleTitle; document.getElementById("cert-date").textContent=new Date().toLocaleDateString(); document.getElementById("cert-score").textContent=`${score}%`; document.getElementById("cert-code").textContent=code; document.getElementById("download-png").addEventListener('click', async ()=>{ const node=document.getElementById("certificate"); const canvas=await html2canvas(node,{scale:2}); const a=document.createElement('a'); a.download=`SustainabilityHub_Certificate_${code}.png`; a.href=canvas.toDataURL(); a.click(); }); document.getElementById("download-pdf").addEventListener('click', async ()=>{ const node=document.getElementById("certificate"); const canvas=await html2canvas(node,{scale:2}); const imgData=canvas.toDataURL('image/png'); const {jsPDF}=window.jspdf; const pdf=new jsPDF('landscape','pt','a4'); const pw=pdf.internal.pageSize.getWidth(); const ph=pdf.internal.pageSize.getHeight(); const iw=pw-80; const ih=(canvas.height*iw)/canvas.width; const y=(ph-ih)/2; pdf.addImage(imgData,'PNG',40,y,iw,ih); pdf.save(`SustainabilityHub_Certificate_${code}.pdf`); }); }
